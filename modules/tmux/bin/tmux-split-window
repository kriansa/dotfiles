#!/usr/bin/bash
#
# This is a helper on top of tmux so we can split windows on the same directory, while keeping a
# reference if this directory is currently a symlink. This is currently not supported natively by
# tmux, so we need to step in by providing this integration.
#
# This integration consists in setting a tmux variable for each pane with the current cwd. Then,
# whenever we need to split panes, we pass this executable the pane ID and we retrieve that variable
# previously set. See `tmux/init.fish` for more info.
#
# If this behavior ever changes, we simply need to replace our bindings to the following:
#   bind -T alacritty d split-window -h -c "#{pane_current_path}"
#   bind -T alacritty D split-window -c "#{pane_current_path}"
#
# Usage: tmux-split-window [-hv] <pane_id>

direction=$1
pane_id=$2

cwd=$(tmux show -v "@cwd_${pane_id}")
flags+=("${direction}" "cd '${cwd}'; exec ${SHELL}")

exec tmux split-window "${flags[@]}"
