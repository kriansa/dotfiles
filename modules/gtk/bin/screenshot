#!/usr/bin/env bash
#
# This utility is a wrapper arond gnome-screenshot that takes screen shots using the same file name
# format used by macOS screenshots. This is useful for keeping consistency between the OSes since
# I use the same folder for screenshots on both systems.

main() {
  declare ARGS=() USE_DEFAULT=1
  parse_cli "$@"
  use_default_file_parameter
  gnome-screenshot "${ARGS[@]}"
}

parse_cli() {
  while [ $# -gt 0 ]; do
    case $1 in
      # If any of -c or -f options are used, then don't forward the default file option
      -c|--clipboard|-f|--file|--file=*) USE_DEFAULT=0 ;& # fallthrough

      # Pass everything through
      *) ARGS+=("$1"); shift ;;
    esac
  done
}

use_default_file_parameter() {
  test "$USE_DEFAULT" = 0 && return

  local name path ext
  name="Screen Shot $(date "+%F") at $(date "+%I.%M.%S %p")"
  path=$(gsettings get org.gnome.gnome-screenshot auto-save-directory | cut -d "'" -f 2)
  ext=$(gsettings get org.gnome.gnome-screenshot default-file-type | cut -d "'" -f 2)

  ARGS+=(-f "$path/$name.$ext")
}

main "$@"
